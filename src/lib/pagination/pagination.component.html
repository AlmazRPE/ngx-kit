<ngx-kit-block
  class="w-screen text-center"
  *ngIf="{
    _config_: config$ | async,
    items: allPaginationItems$ | async,
    afilters: activePaginationFilters$ | async,
    dfilters: disabledPaginationFilters$ | async
  } as data"
>
  <ng-template>
    <!------------------------------------------------------------------------>
    <!-------------------------------- HEADER -------------------------------->
    <!------------------------------------------------------------------------>
    <ng-container
      *ngIf="data.items!.length > 0
        && data._config_!.disabledParts.has(PagPart.Items) == false"
    >
      <div class="w-full flex flex-row justify-between">
        <div
          class="w-full flex flex-col gap-2 overflow-x-visible"
        >
          <ngx-kit-mat-input
            [type]="InpType.Text"
            [placeholder]="data._config_!.fullTextSearchTxt"
            (inputValue)="setFullTextSearchVal($event)"
            *ngIf="data._config_!.disabledParts.has(
              PagPart.SearchField
            ) == false"
          />

          <div
            class="flex gap-2 flex-row flex-wrap justify-start"
          >
            <div class="flex flex-row" *ngFor="let filter of data.afilters">
              <div
                class="px-3 bg-c10 text-white rounded-l
                       cursor-default truncate"
              >
                {{filter.labelText}}
              </div>
              <div
                class="px-2 bg-red-50 rounded-r cursor-pointer"
                (click)="dropFilter(filter.id)"
              >X
              </div>
            </div>
          </div>
        </div>
        <ngx-kit-button
          *ngIf="data.afilters!.length + data.dfilters!.length > 0
            && data._config_!.disabledParts.has(PagPart.Filters) == false"
          class="justify-center ml-2"
          [mode]="isFiltersWindowShown == false
                  ? BtnMode.DEFAULT
                  : BtnMode.BOOKMARK_ACTIVE"
          (clickFunc)="toggleFiltersWindow()"
        >
          <img
            class="w-5 h-5"
            [src]="data._config_!.filterIconPath"
            [alt]="'👁️'"
          >
        </ngx-kit-button>
      </div>

      <ng-container *ngIf="isFiltersWindowShown">
        <div class="flex flex-col gap-2 mt-1">
          <div *ngFor="let filter of data.afilters">
            <div class="mb-1 text-left">
              {{filter.labelText}}
            </div>
            <ngx-kit-mat-input
              [type]="filter.inputConfig.type"
              [placeholder]="filter.inputConfig['placeholder'] != undefined
                             ? filter.inputConfig['placeholder']
                             : 'Enter something...'"
              (inputValue)="filterChange(filter.id, $event)"
            />
          </div>

          <div class="flex flex-row gap-2 flex-wrap">
            <div
              class="flex flex-row"
              *ngFor="let filter of data.dfilters">
              <div
                class="px-3 bg-c10 text-white rounded-l
                       cursor-default truncate"
              >
                {{filter.labelText}}
              </div>
              <div
                class="px-2 bg-red-50 rounded-r cursor-pointer"
                (click)="addFilter(filter.id)"
              >+
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </ng-container>

    <!------------------------------------------------------------------------>
    <!--------------------------------- BODY --------------------------------->
    <!------------------------------------------------------------------------>
    <ngx-kit-hr
      class="w-full mb-2 opacity-25"
      *ngIf="data._config_!.disabledParts.has(PagPart.FirstHr) == false"
    ></ngx-kit-hr>
    <ng-container *ngIf="activePaginationItems$ | async as items">
      <div
        class="pb-1 overflow-x-hidden mt-1"
        (overflowing)="isTableOverflowing=true"
        (notOverflowing)="isTableOverflowing=false"
        paginationOverflowDetect [curPage]="curPage"
        #tableRef
      >
        <table
          class="overflow-auto w-full"
          [ngClass]="{
              'flex' : data._config_!.viewType == PagViewType.List
                       || data._config_!.viewType == PagViewType.Tiles,
              'flex-col' : data._config_!.viewType == PagViewType.List,
              'flex-row
               flex-wrap
               justify-center' : data._config_!.viewType == PagViewType.Tiles,
              'border-collapse' : data._config_!.viewType == PagViewType.Table
            }"
          *ngIf="items.length > 0
            && data._config_!.disabledParts.has(PagPart.Items) == false;
              else no_items"
        >
          <ng-container *ngIf="data._config_!.viewType == PagViewType.Table">
            <colgroup *ngIf="data._config_!.columnFixedWidths.size > 0">
              <ng-container *ngFor="let column of tableColumns">
                <col
                  *ngIf="column.disabled == false"
                  (onCreate)="setColumnFixedWidth(colRef, column)"
                  NgxKitOnCreate
                  #colRef
                >
              </ng-container>
            </colgroup>

            <tr class="w-full">
              <ng-container *ngFor="let column of tableColumns">
                <th
                  class="px-3 align-top cursor-pointer
                         hover:bg-c10-half select-none"
                  *ngIf="column.disabled == false"
                  [ngClass]="{
                    'bg-c10-fourth': chosenColumnCheck(
                                       column,
                                       [SortColMode.ASC, SortColMode.DESC]
                                     ) == true,
                    'cursor-pointer hover:bg-c10-half': column.sorting == true
                  }"
                  (click)="column.sorting == true
                    ? sortPaginationItems(column, $event)
                    : null
                  "
                  >
                  <div
                    class="flex flex-col text-left"
                  >
                    <ng-container
                      *ngIf="chosenColumnCheck(column,
                               [SortColMode.ASC]) == true"
                    >
                      <div class="w-full flex justify-center">
                        <img
                          class="w-4 h-4"
                          [src]="data._config_!.ascSortIconPath"
                          [alt]="'⬇️'"
                        >
                      </div>
                    </ng-container>

                    <ng-container
                      *ngIf="chosenColumnCheck(column,
                               [SortColMode.DESC]) == true"
                    >
                      <div class="w-full flex justify-center">
                        <img
                          class="w-4 h-4"
                          [src]="data._config_!.descSortIconPath"
                          [alt]="'⬆️'"
                        >
                      </div>
                    </ng-container>

                    <div
                      *ngIf="column.header == PagColTag.NameHeader"
                      class="w-full flex"
                      [ngClass]="
                        chosenColumnCheck(
                          column,
                          [SortColMode.DESC, SortColMode.ASC]
                        ) == true
                          ? 'justify-center'
                          : column.alignTHClass
                      "
                    >
                      <div>
                        {{column.name}}
                      </div>
                    </div>
                  </div>
                </th>
              </ng-container>
            </tr>
          </ng-container>

          <tbody #tableBodyRef>
            <ng-container
              *ngFor="let item of items; index as i"
            >
              <tr
                *ngIf="MathModule.floor(i / data._config_!.itemCntPerPage) == curPage"
                class="select-none"
                [ngClass]="{
                  'bg-white/25':
                    data._config_!.viewType == PagViewType.Table && i % 2 == 1,
                  'hover:bg-c10-half cursor-pointer':
                    data._config_!.viewType == PagViewType.Table
                      && item.route != null,
                  'cursor-default':
                    data._config_!.viewType == PagViewType.Table
                      && item.route == null,
                  'mt-1':
                    MathModule.floor(i / data._config_!.itemCntPerPage) == curPage
                }"
                (click)="goLink(item.route)"
              >
                <!-- NO TABLE VIEW -->
                <ng-container
                  *ngIf="data._config_!.viewType != PagViewType.Table"
                >
                  <ngx-kit-button
                    [ngClass]="{
                      'w-40 h-40 block m-1':
                        data._config_!.viewType == PagViewType.Tiles
                    }"
                    [extraCssClasses]="['h-full']"
                    (clickFunc)="goLink(item.route)"
                  >
                    {{item.text}}
                  </ngx-kit-button>
                </ng-container>

                <!-- TABLE VIEW -->
                <ng-container
                  *ngIf="data._config_!.viewType == PagViewType.Table"
                >
                  <ng-container *ngFor="let column of tableColumns">
                    <td
                      *ngIf="column.disabled == false"
                      class="px-3 py-1.5"
                      [ngClass]="[column.alignTDClass]"
                      [ngSwitch]="true"
                    >
                      <div
                        *ngIf="item.attr[column.name] != undefined"
                        (onCreate)="setRowFixedHeight(cellRef)"
                        NgxKitOnCreate
                        #cellRef
                      >
                        <!-- DATETIME | DATE | TIME -->
                        <div
                          *ngSwitchCase="column.type === PagAttrType.DATETIME
                                         || column.type === PagAttrType.DATE
                                         || column.type === PagAttrType.TIME"
                        >
                          {{
                            item.attr[column.name].body.value == null
                              ? " "
                              : (item.attr[column.name].body.formatter
                                 ?? defaultDTFormatters.get(column.type))
                                   .format(item.attr[column.name].body.value) +
                                (item.attr[column.name].body.endStr ?? '')
                          }}
                        </div>

                        <!-- ICON -->
                        <div
                          *ngSwitchCase="column.type === PagAttrType.ICON"
                        >
                          <ng-container
                            *ngIf="item.attr[column.name].body
                                     .animatePing == true"
                          >
                            <ngx-kit-status-circle
                              class="inline-block"
                              [mode]="CircleMode.IMAGE"
                              [imgSrc]="item.attr[column.name].body.src"
                              [inputCssClasses]=
                                "item.attr[column.name].body.cssClasses ?? null"
                            >
                            </ngx-kit-status-circle>
                          </ng-container>

                          <ng-container
                            *ngIf="item.attr[column.name].body
                                     .animatePing == false"
                          >
                            <span
                            class="inline-block"
                            [ngClass]=
                              "item.attr[column.name].body.cssClasses
                               ?? ['w-4', 'h-4']"
                            >
                              <img
                                [ngClass]=
                                  "item.attr[column.name].body.cssClasses
                                   ?? ['w-4', 'h-4']"
                                [src]="item.attr[column.name].body.src"
                              >
                            </span>
                          </ng-container>
                        </div>

                        <!-- ICONS -->
                        <div
                          *ngSwitchCase="column.type === PagAttrType.ICONS"
                          class="flex flex-row flex-wrap gap-1.5"
                        >
                          <div
                            *ngFor="let icon of item.attr[column.name].body"
                          >
                            <ng-container
                              *ngIf="icon.animatePing == true"
                            >
                              <ngx-kit-status-circle
                                class="inline-block"
                                [mode]="CircleMode.IMAGE"
                                [imgSrc]="icon.src"
                                [inputCssClasses]="icon.cssClasses ?? null"
                              >
                              </ngx-kit-status-circle>
                            </ng-container>

                            <ng-container
                              *ngIf="icon.animatePing == false"
                            >
                              <span
                              class="inline-block"
                              [ngClass]="icon.cssClasses ?? ['w-4', 'h-4']"
                              >
                                <img
                                  [ngClass]="icon.cssClasses ?? ['w-4', 'h-4']"
                                  [src]="icon.src"
                                >
                              </span>
                            </ng-container>
                          </div>
                        </div>

                        <!-- LABEL -->
                        <div
                          *ngSwitchCase="column.type === PagAttrType.LABEL"
                        >
                          <ngx-kit-label
                            [title]="item.attr[column.name].body.title"
                            [bgColor]="item.attr[column.name].body.bgColor"
                            [textColor]="item.attr[column.name].body.textColor"
                            [isShrunk]="true"
                          ></ngx-kit-label>
                        </div>

                        <!-- LABELS -->
                        <div
                          *ngSwitchCase="column.type === PagAttrType.LABELS"
                          class="flex flex-row flex-wrap"
                        >
                          <div
                            *ngFor="let label of item.attr[column.name].body"
                          >
                            <ngx-kit-label
                              [title]="label.title"
                              [bgColor]="label.bgColor"
                              [textColor]="label.textColor"
                              [isShrunk]="true"
                            ></ngx-kit-label>
                          </div>
                        </div>

                        <!-- BUTTON -->
                        <div
                          *ngSwitchCase="column.type === PagAttrType.BUTTON"
                        >
                          <ngx-kit-button
                            [ngClass]= "item.attr[column.name].body.cssClasses ?? []"
                            (clickFunc)="item.attr[column.name].body.clickFunc()"
                            [mode]="item.attr[column.name].body.mode ?? BtnMode.DEFAULT"
                            [isEnabled]="item.attr[column.name].body.isEnabled ?? true"
                          >
                            <ng-container
                              *ngIf="item.attr[column.name].body.imageSrc != undefined"
                            >
                              <img
                                [ngClass]="item.attr[column.name].body.cssClasses ?? ['w-4', 'h-4']"
                                [src]="item.attr[column.name].body.imageSrc"
                              >
                            </ng-container>

                            <ng-container
                              *ngIf="item.attr[column.name].body.imageSrc == undefined"
                            >
                              {{item.attr[column.name].body.labelText}}
                            </ng-container>
                          </ngx-kit-button>
                        </div>

                        <!-- BOOLEAN -->
                        <div
                          *ngSwitchCase="column.type === PagAttrType.BOOLEAN"
                        >
                          <ngx-kit-status-circle
                            class="inline-block"
                            [mode]="item.attr[column.name].body == true
                                    ? CircleMode.ACTIVE
                                    : CircleMode.NONACTIVE"
                          >
                          </ngx-kit-status-circle>
                        </div>

                        <!-- DEFAULT -->
                        <div *ngSwitchDefault>
                          {{item.attr[column.name].body}}
                        </div>
                      </div>

                      <div
                        *ngIf="item.dummy === true"
                        (onCreate)="setRowFixedHeight(cellRef)"
                        NgxKitOnCreate
                        #cellRef
                      ></div>
                    </td>
                  </ng-container>
                </ng-container>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>

      <ng-container *ngIf="isTableOverflowing">
        <div class="flex flex-row justify-between mt-2 mb-1">
          <ngx-kit-button
            class="flex justify-center h-16"
            (click)="scrollTableRight($event)"
          >
            <<<
          </ngx-kit-button>
          <ngx-kit-button
            class="flex justify-center h-16"
            (click)="scrollTableLeft($event)"
          >
            >>>
          </ngx-kit-button>
        </div>
      </ng-container>
    </ng-container>

    <ngx-kit-hr
      class="w-full opacity-25"
      *ngIf="data._config_!.disabledParts.has(PagPart.SecondHr) == false"
    ></ngx-kit-hr>

    <!------------------------------------------------------------------------>
    <!-------------------------------- FOOTER -------------------------------->
    <!------------------------------------------------------------------------>
    <ng-container
      *ngIf="data.items!.length > 0
        && data._config_!.disabledParts.has(PagPart.Footer) == false
        && data._config_!.disabledParts.has(PagPart.Items) == false"
    >
      <div class="flex flex-row justify-between items-center">
        <ngx-kit-button
          class="flex justify-center"
          (clickFunc)="getPreviousPage()"
          [isEnabled]="curPage > 0"
        >
          < {{data._config_!.backTxt}}
        </ngx-kit-button>

        <div class="flex flex-row">
          <div
            *ngFor="let iter of [].constructor(pageCnt); let i = index"
          >

            <ng-container
                *ngIf="
                  i == 0
                  || i == pageCnt - 1
                  || (i > leftSlice
                      && i <= leftSlice + data._config_!.visiblePagesCnt - 2)"
            >
              <ng-container
                  *ngIf="i == curPage"
              >
                <div class="mx-2">
                  <ngx-kit-button
                    class="justify-center"
                    [mode]="BtnMode.BOOKMARK_ACTIVE"
                    (clickFunc)="getPage(i)"
                  >
                    {{i + 1}}
                  </ngx-kit-button>
                </div>
              </ng-container>

              <ng-container
                  *ngIf="i != curPage"
              >
                <div class="mx-2">
                  <ngx-kit-button
                    class="justify-center"
                    (clickFunc)="getPage(i)"
                  >
                    {{i + 1}}
                  </ngx-kit-button>
                </div>
              </ng-container>

            </ng-container>

            <ng-container
                *ngIf="i == 1 && leftSlice > 0"
            >
              <div class="text-center mx-2">...</div>
            </ng-container>

            <ng-container
                *ngIf="i == pageCnt - 2
                       && i > leftSlice + data._config_!.visiblePagesCnt - 2"
            >
              <div class="text-center mx-2">...</div>
            </ng-container>


          </div>
        </div>

        <ngx-kit-button
          class="flex justify-center"
          (clickFunc)="getNextPage()"
          [isEnabled]="curPage < pageCnt - 1"
        >
          {{data._config_!.forwardTxt}} >
        </ngx-kit-button>
      </div>
    </ng-container>

    <ng-template #no_items>
      <ng-container
        *ngIf="data._config_!.disabledParts.has(PagPart.Items) == true"
      >
        <div class="no-items text-center mt-2 fst-italic">
          {{data._config_!.hiddenItemsTxt}}
        </div>
      </ng-container>

      <ng-container
        *ngIf="data.items!.length > 0
          && data._config_!.disabledParts.has(PagPart.Items) == false"
      >
        <div class="no-items text-center mt-2 fst-italic">
          {{data._config_!.noSuitableItemsTxt}}
        </div>
      </ng-container>

      <ng-container
        *ngIf="data.items!.length == 0
        && data._config_!.disabledParts.has(PagPart.Items) == false"
      >
        <div class="no-items text-center mt-2 fst-italic">
          {{data._config_!.noAnyItemsTxt}}
        </div>
      </ng-container>
    </ng-template>
  </ng-template>
</ngx-kit-block>
