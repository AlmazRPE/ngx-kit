<ngx-minithings-block class="w-screen text-center">
  <ng-template>

    <div class="w-full flex flex-row justify-between">
      <div class="w-full mr-2 flex flex-col gap-2 pb-3 overflow-x-scroll">
        <ngx-minithings-input
          [type]="InpType.Text"
          [placeholder]="'–ü–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤–∞–º...'"
          [isFormRequired]="false"
          [cssClasses]="['w-full', 'h-7', 'px-2', 'rounded-sm']"
          (inputValue)="columnFilterChange($event)"
        />

        <div class="flex gap-2 flex-row flex-wrap justify-start">
          <ng-container *ngIf="paginationFilters$ | async as filters">
            <div class="flex flex-row" *ngFor="let filter of filters">
              <div class="px-3 bg-c10 text-white rounded-l cursor-default">
                {{filter.labelText}}
              </div>
              <div
                class="px-1.5 bg-red-50 rounded-r cursor-pointer"
                (click)="dropFilter(filter.id)"
              >X
              </div>
            </div>
          </ng-container>
        </div>
      </div>

      <ngx-minithings-button
        class="justify-center"
        (clickFunc)="toggleFiltersWindow()"
      >
        üëÅÔ∏è
      </ngx-minithings-button>
    </div>

    <ng-container *ngIf="isFiltersWindowShown">
      <div class="flex flex-col gap-2 mt-1">
        <ng-container *ngIf="paginationFilters$ | async as filters">
          <div *ngFor="let filter of filters">
            <div class="mb-1 text-left">
              {{filter.labelText}}
            </div>
            <ngx-minithings-input
              [type]="filter.inputConfig.type"
              [min]="filter.inputConfig['min']"
              [max]="filter.inputConfig['max']"
              [placeholder]="filter.inputConfig['placeholder'] != undefined
                             ? filter.inputConfig['placeholder']
                             : '–í–≤–µ–¥–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å...'"
              [isFormRequired]="false"
              [cssClasses]="['w-full', 'px-2']"
              (inputValue)="filterChange(filter.id, $event)"
            />
          </div>
        </ng-container>


      <div class="flex flex-row gap-2">
        <div
          class="flex flex-row"
          *ngFor="let filter of paginationFilters">
          <div class="px-3 bg-c10 text-white rounded-l cursor-default">
            {{filter.labelText}}
          </div>
          <div
            class="px-1.5 bg-red-50 rounded-r cursor-pointer"
            (click)="addFilter(filter.id)"
          >+
          </div>
        </div>
      </div>

      </div>
    </ng-container>

    <ngx-minithings-hr class="w-full mb-2"></ngx-minithings-hr>
    <ng-container *ngIf="paginationItems$ | async as items">
      <table
        class="overflow-auto max-h-[60vh] w-full"
        [ngClass]="{
            'flex' : config.viewType == PagViewType.List
                     || config.viewType == PagViewType.Tiles,
            'flex-col' : config.viewType == PagViewType.List,
            'flex-row
             flex-wrap
             justify-center' : config.viewType == PagViewType.Tiles,
            'border-collapse' : config.viewType == PagViewType.Table
          }"
        *ngIf="items.length > 0; else no_items"
      >
        <ng-container *ngIf="config.viewType == PagViewType.Table">
          <tr class="w-full">
            <th
              class="px-3 align-top cursor-pointer hover:bg-c10/50 select-none"
              *ngFor="let column of tableColumns;"
              [ngClass]="{
                'bg-c10/25': chosenColumnCheck(column,
                               [SortColMode.ASC, SortColMode.DESC]) == true
              }"
              (click)="sortPaginationItems(column, $event)"
              >
              <div
                class="flex flex-row gap-1 text-left"
                [ngClass]="{
                  'justify-center': column.type == 'boolean',
                  'justify-start': column.type != 'boolean'
                }"
              >

                <div>{{column.labelText}}</div>

                <ng-container
                  *ngIf="chosenColumnCheck(column, [SortColMode.ASC]) == true"
                >
                  <div>‚¨áÔ∏è</div>
                </ng-container>

                <ng-container
                  *ngIf="chosenColumnCheck(column, [SortColMode.DESC]) == true"
                >
                  <div>‚¨ÜÔ∏è</div>
                </ng-container>
              </div>
            </th>
          </tr>
        </ng-container>
        <tr
          *ngFor="
            let item of items;
              index as i;
          "
          [ngClass]="{
            'bg-white/25': i % 2 == 1 && config.viewType == PagViewType.Table,
            'hover:bg-c10/75
             cursor-pointer' : config.viewType == PagViewType.Table,
            'mt-1' : MathModule.floor(i / config.itemCntPerPage) == curPage
          }"
          (click)="goLink(item.route)"
        >
          <ng-container
            *ngIf="MathModule.floor(i / config.itemCntPerPage) == curPage"
          >
            <ng-container
              *ngIf="config.viewType != PagViewType.Table; else show_table"
            >
              <ngx-minithings-button
                [ngClass]="{
                  'w-40 h-40 block m-1' : config.viewType == PagViewType.Tiles
                }"
                [extraCssClasses]="['h-full']"
                (clickFunc)="goLink(item.route)"
              >
                {{item.text}}
              </ngx-minithings-button>

            </ng-container>

            <ng-template #show_table>
              <td
                *ngFor="let column of tableColumns;"
                class="px-3 py-1.5 text-left"
                [ngClass]="{
                  'align-top text-left' : column.type != 'boolean',
                  'text-center' : column.type == 'boolean'
                }"
                >

                <ng-container
                  *ngIf="
                    column.type != 'boolean'
                    || item.attr[column.labelText] == undefined;
                      else boolean_decor
                  "
                  >
                  {{item.attr[column.labelText]}}
                </ng-container>
                <ng-template #boolean_decor>
                  <ngx-minithings-status-circle
                    class="inline-block"
                    [mode]="item.attr[column.labelText] == true
                            ? CircleMode.ACTIVE
                            : CircleMode.NONACTIVE"
                  >
                  </ngx-minithings-status-circle>
                </ng-template>

              </td>
            </ng-template>

          </ng-container>
        </tr>
      </table>
    </ng-container>

    <ng-template #no_items>
      <div class="no-items text-center mt-2 fst-italic">
        –°—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã...
      </div>
    </ng-template>

    <ngx-minithings-hr class="w-full mb-2"></ngx-minithings-hr>

    <div class="flex flex-row justify-between items-center">

      <ngx-minithings-button
        class="flex justify-center"
        (clickFunc)="getPreviousPage()"
        [isEnabled]="curPage > 0"
      >
        < –ù–ê–ó–ê–î
      </ngx-minithings-button>

      <div class="flex flex-row">
        <div
          *ngFor="let iter of [].constructor(pageCnt); let i = index"
        >

          <ng-container
              *ngIf="i == 0
                     || i == pageCnt - 1
                     || (i > leftSlice
                         && i <= leftSlice + config.visiblePagesCnt - 2)"
          >
            <ng-container
                *ngIf="i == curPage"
            >
              <div class="mx-2">
                <ngx-minithings-button
                  class="justify-center"
                  [mode]="BtnMode.DIMMED"
                  (clickFunc)="getPage(i)"
                >
                  {{i + 1}}
                </ngx-minithings-button>
              </div>
            </ng-container>

            <ng-container
                *ngIf="i != curPage"
            >
              <div class="mx-2">
                <ngx-minithings-button
                  class="justify-center"
                  (clickFunc)="getPage(i)"
                >
                  {{i + 1}}
                </ngx-minithings-button>
              </div>
            </ng-container>

          </ng-container>

          <ng-container
              *ngIf="i == 1 && leftSlice > 0"
          >
            <div class="text-center mx-2">...</div>
          </ng-container>

          <ng-container
              *ngIf="i == pageCnt - 2
                     && i > leftSlice + config.visiblePagesCnt - 2"
          >
            <div class="text-center mx-2">...</div>
          </ng-container>


        </div>
      </div>

      <ngx-minithings-button
        class="flex justify-center"
        (clickFunc)="getNextPage()"
        [isEnabled]="curPage < pageCnt - 1"
      >
        –í–ü–ï–†–Å–î >
      </ngx-minithings-button>

    </div>

  </ng-template>
</ngx-minithings-block>
